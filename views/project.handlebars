<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{project.title}} — Meakalia Gilman</title>
    <link rel="stylesheet" type="text/css" href="/assets/project-style.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
    {{!-- <style>
        :root {
            --crimson:  #550101;
            --deep-red: #790B0B;
            --blush:    #FFE5E4;
            --ink:      #1a0505;
            --border:   rgba(85,1,1,0.12);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; font-family: 'DM Mono', monospace; background: var(--blush); color: var(--ink); }

        /* ── Header ── */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2rem 3rem;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0;
            background: var(--blush);
            z-index: 200;
        }
        .logo-link {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem; font-style: italic; font-weight: 300;
            color: var(--crimson); text-decoration: none; letter-spacing: 0.08em;
        }
        .logo-link:hover { opacity: 0.7; }
        nav a {
            font-size: 0.65rem; letter-spacing: 0.22em; text-transform: uppercase;
            color: var(--crimson); text-decoration: none; margin-left: 2.5rem; transition: opacity 0.2s;
        }
        nav a:hover { opacity: 0.5; }

        /* ── Breadcrumb ── */
        .breadcrumb {
            padding: 1.2rem 3rem 0;
            font-size: 0.6rem; letter-spacing: 0.18em; text-transform: uppercase;
        }
        .breadcrumb a { color: var(--crimson); opacity: 0.45; text-decoration: none; transition: opacity 0.2s; }
        .breadcrumb a:hover { opacity: 0.8; }
        .breadcrumb span { color: var(--crimson); opacity: 0.3; margin: 0 0.5rem; }

        /* ── Project layout ── */
        .project-page {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 0;
            min-height: calc(100vh - 80px);
        }
        @media (max-width: 900px) {
            .project-page { grid-template-columns: 1fr; }
            .sidebar { border-left: none; border-top: 1px solid var(--border); }
        }

        /* ── Main viewer ── */
        .viewer {
            display: flex;
            flex-direction: column;
            padding: 2rem 3rem;
            animation: fadeUp 0.6s ease both;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .viewer-frame {
            flex: 1;
            min-height: 520px;
            background: var(--ink);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
        }

        /* ── iFrame embed ── */
        .viewer-frame iframe {
            width: 100%; height: 100%; min-height: 520px;
            border: none; display: block;
        }

        /* ── Three.js canvas fills the frame ── */
        #three-canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        /* Viewer controls bar */
        .viewer-controls {
            display: flex;
            gap: 0.6rem;
            margin-top: 0.8rem;
            align-items: center;
        }
        .ctrl-btn {
            font-family: 'DM Mono', monospace;
            font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase;
            padding: 0.4rem 0.9rem; border: 1px solid var(--border);
            background: transparent; color: var(--crimson); cursor: pointer; border-radius: 2px;
            transition: background 0.2s, color 0.2s;
        }
        .ctrl-btn:hover { background: var(--crimson); color: var(--blush); }
        .ctrl-hint {
            margin-left: auto;
            font-size: 0.58rem; letter-spacing: 0.12em;
            color: var(--crimson); opacity: 0.35;
        }

        /* ── Sidebar ── */
        .sidebar {
            border-left: 1px solid var(--border);
            padding: 2.5rem 2rem;
            animation: fadeUp 0.6s 0.15s ease both;
        }
        .proj-type-badge {
            display: inline-block;
            font-size: 0.55rem; letter-spacing: 0.2em; text-transform: uppercase;
            padding: 0.3rem 0.7rem;
            background: var(--crimson); color: var(--blush);
            border-radius: 2px; margin-bottom: 1.2rem;
        }
        .proj-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.4rem; font-weight: 300; line-height: 1.1;
            color: var(--crimson); margin-bottom: 0.5rem;
        }
        .proj-year {
            font-size: 0.6rem; letter-spacing: 0.18em; text-transform: uppercase;
            color: var(--crimson); opacity: 0.45; margin-bottom: 1.8rem;
        }
        .sidebar-section { margin-bottom: 2rem; }
        .sidebar-section h3 {
            font-size: 0.58rem; letter-spacing: 0.22em; text-transform: uppercase;
            color: var(--crimson); opacity: 0.5; margin-bottom: 0.7rem;
        }
        .sidebar-section p {
            font-size: 0.68rem; line-height: 1.85; color: var(--ink); opacity: 0.7;
        }

        .tech-list {
            display: flex; gap: 0.4rem; flex-wrap: wrap;
        }
        .tech-pill {
            font-size: 0.55rem; letter-spacing: 0.15em; text-transform: uppercase;
            padding: 0.2rem 0.6rem; border: 1px solid var(--border);
            color: var(--crimson); border-radius: 2px;
        }

        .proj-links { display: flex; flex-direction: column; gap: 0.6rem; margin-top: 2rem; }
        .proj-link {
            font-size: 0.62rem; letter-spacing: 0.18em; text-transform: uppercase;
            color: var(--crimson); text-decoration: none;
            padding: 0.7rem 1rem; border: 1px solid var(--border);
            display: flex; justify-content: space-between;
            transition: background 0.2s, color 0.2s;
        }
        .proj-link:hover { background: var(--crimson); color: var(--blush); }

        /* ── Loading state ── */
        .viewer-loading {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: var(--ink);
        }
        .dot-loader { display: flex; gap: 8px; }
        .dot-loader span {
            width: 8px; height: 8px; border-radius: 50%;
            background: rgba(255,229,228,0.5);
            animation: bounce 0.5s infinite alternate;
        }
        .dot-loader span:nth-child(2) { animation-delay: 0.1s; }
        .dot-loader span:nth-child(3) { animation-delay: 0.2s; }
        @keyframes bounce { 100% { transform: translateY(-8px); } }
    </style> --}}
</head>
<body>

<header>
    <a class="logo-link" href="/">Meakalia Gilman</a>
    <nav>
        <a href="/about">About</a>
        <a href="/work">Work</a>
        <a href="/contact">Contact</a>
    </nav>
</header>

<div class="breadcrumb">
    <a href="/work">Work</a>
    <span>/</span>
    <span style="opacity:0.8; color: var(--crimson);">{{project.title}}</span>
</div>

<div class="project-page">

    <!-- ── Viewer ── -->
    <section class="viewer">
        <div class="viewer-frame" id="viewer-frame">
            <!-- Loading dots while content initialises -->
            <div class="viewer-loading" id="viewer-loading">
                <div class="dot-loader"><span></span><span></span><span></span></div>
            </div>

            {{!-- Conditional: rendered server-side by handlebars --}}
            {{#if project.iframeUrl}}
                <iframe id="project-iframe"
                    src="{{project.iframeUrl}}"
                    allowfullscreen
                    sandbox="allow-scripts allow-same-origin allow-forms"
                    onload="document.getElementById('viewer-loading').style.display='none'">
                </iframe>
            {{else}}
                {{!-- Three.js canvas for 3D models --}}
                <canvas id="three-canvas"></canvas>
            {{/if}}
        </div>

        <div class="viewer-controls">
            {{#if project.iframeUrl}}
                <button class="ctrl-btn" onclick="document.getElementById('project-iframe').src = document.getElementById('project-iframe').src">↺ Reload</button>
                <button class="ctrl-btn" onclick="window.open('{{project.iframeUrl}}','_blank')">↗ Open Full</button>
            {{else}}
                <button class="ctrl-btn" id="btn-reset">↺ Reset View</button>
                <button class="ctrl-btn" id="btn-wireframe">⬡ Wireframe</button>
                <button class="ctrl-btn" id="btn-bg">◐ Toggle BG</button>
                <span class="ctrl-hint">Drag to rotate · Scroll to zoom</span>
            {{/if}}
        </div>
    </section>

    <!-- ── Sidebar ── -->
    <aside class="sidebar">
        <span class="proj-type-badge">{{project.type}}</span>
        <h1 class="proj-title">{{project.title}}</h1>
        <div class="proj-year">{{project.year}}</div>

        <div class="sidebar-section">
            <h3>About</h3>
            <p>{{project.description}}</p>
        </div>

        {{#if project.role}}
        <div class="sidebar-section">
            <h3>Role</h3>
            <p>{{project.role}}</p>
        </div>
        {{/if}}

        <div class="sidebar-section">
            <h3>Built with</h3>
            <div class="tech-list">
                {{#each project.tech}}
                    <span class="tech-pill">{{this}}</span>
                {{/each}}
            </div>
        </div>

        <div class="proj-links">
            {{#if project.githubUrl}}
                <a class="proj-link" href="{{project.githubUrl}}" target="_blank">
                    <span>GitHub</span><span>↗</span>
                </a>
            {{/if}}
            {{#if project.liveUrl}}
                <a class="proj-link" href="{{project.liveUrl}}" target="_blank">
                    <span>Live Site</span><span>↗</span>
                </a>
            {{/if}}
        </div>
    </aside>

</div>

<!-- ══════════════════════════════════════
     Three.js viewer — only runs if the
     canvas element exists (3D projects)
══════════════════════════════════════ -->
<script>
(function () {
    const canvas = document.getElementById('three-canvas');
    if (!canvas) return;

    // Remove loading spinner
    document.getElementById('viewer-loading').style.display = 'none';

    // Dynamically load Three.js from CDN
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
    script.onload = initThree;
    document.head.appendChild(script);

    function initThree() {
        const THREE = window.THREE;
        const frame = document.getElementById('viewer-frame');

        /* ── Scene ── */
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a0505);

        /* ── Camera ── */
        const camera = new THREE.PerspectiveCamera(45, frame.clientWidth / frame.clientHeight, 0.1, 100);
        camera.position.set(0, 1.5, 4);

        /* ── Renderer ── */
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
        renderer.setSize(frame.clientWidth, frame.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;

        /* ── Lighting ── */
        scene.add(new THREE.AmbientLight(0xffe5e4, 0.6));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(3, 5, 3);
        dirLight.castShadow = true;
        scene.add(dirLight);
        const rimLight = new THREE.DirectionalLight(0x550101, 0.4);
        rimLight.position.set(-3, 1, -3);
        scene.add(rimLight);

        /* ── Placeholder mesh (replace with your GLB/OBJ loader) ── */
        const geo = new THREE.TorusKnotGeometry(1, 0.32, 128, 16);
        const mat = new THREE.MeshStandardMaterial({
            color: 0x550101, roughness: 0.3, metalness: 0.7
        });
        const mesh = new THREE.Mesh(geo, mat);
        mesh.castShadow = true;
        scene.add(mesh);

        // Grid
        const grid = new THREE.GridHelper(8, 20, 0x550101, 0x550101);
        grid.material.opacity = 0.12;
        grid.material.transparent = true;
        grid.position.y = -1.6;
        scene.add(grid);

        /* ── Orbit controls (manual, no import needed) ── */
        let isDragging = false, prevX = 0, prevY = 0;
        let rotX = 0, rotY = 0, zoom = 4;

        canvas.addEventListener('mousedown', e => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
        window.addEventListener('mouseup', () => { isDragging = false; });
        canvas.addEventListener('mousemove', e => {
            if (!isDragging) return;
            rotY += (e.clientX - prevX) * 0.005;
            rotX += (e.clientY - prevY) * 0.005;
            rotX = Math.max(-1.2, Math.min(1.2, rotX));
            prevX = e.clientX; prevY = e.clientY;
        });
        canvas.addEventListener('wheel', e => {
            zoom += e.deltaY * 0.005;
            zoom = Math.max(1.5, Math.min(10, zoom));
            e.preventDefault();
        }, { passive: false });

        // Touch
        let lastTouch = null;
        canvas.addEventListener('touchstart', e => { lastTouch = e.touches[0]; });
        canvas.addEventListener('touchmove', e => {
            if (!lastTouch) return;
            rotY += (e.touches[0].clientX - lastTouch.clientX) * 0.005;
            rotX += (e.touches[0].clientY - lastTouch.clientY) * 0.005;
            rotX = Math.max(-1.2, Math.min(1.2, rotX));
            lastTouch = e.touches[0];
            e.preventDefault();
        }, { passive: false });

        /* ── Controls bar ── */
        let wireframe = false, darkBg = true;

        document.getElementById('btn-reset').addEventListener('click', () => {
            rotX = 0; rotY = 0; zoom = 4;
        });
        document.getElementById('btn-wireframe').addEventListener('click', () => {
            wireframe = !wireframe;
            mat.wireframe = wireframe;
        });
        document.getElementById('btn-bg').addEventListener('click', () => {
            darkBg = !darkBg;
            scene.background = new THREE.Color(darkBg ? 0x1a0505 : 0xffe5e4);
        });

        /* ── Resize ── */
        window.addEventListener('resize', () => {
            camera.aspect = frame.clientWidth / frame.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(frame.clientWidth, frame.clientHeight);
        });

        /* ── Animate ── */
        const clock = new THREE.Clock();
        (function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // Gentle auto-spin when not dragging
            if (!isDragging) rotY += 0.003;

            mesh.rotation.x = rotX;
            mesh.rotation.y = rotY;

            camera.position.set(
                Math.sin(0) * zoom,
                1.5,
                Math.cos(0) * zoom
            );
            camera.position.z = zoom;
            camera.lookAt(scene.position);

            renderer.render(scene, camera);
        })();

        /* ── Load your actual GLB model ── 
           Uncomment and point to your file once you have it.

           const { GLTFLoader } = await import('/assets/js/GLTFLoader.js');
           const loader = new GLTFLoader();
           loader.load('/assets/models/your-model.glb', (gltf) => {
               scene.remove(mesh); // remove placeholder
               scene.add(gltf.scene);
           });
        */
    }
})();
</script>

</body>
</html>
